<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Invoice Generator</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase Configuration -->
    <script type="module" src="firebase-config.js"></script>
    
    <!-- Legacy Google Sign-In removed to prevent conflicts with Firebase Auth -->
    <!-- All Google authentication now handled through Firebase Google Auth Provider -->
</head>
<body>
    <div id="app">
        <!-- Login Section -->
        <div id="loginSection" class="section">
            <div class="auth-container">
                <!-- Logo and Header -->
                <div class="auth-header">
                    <div class="logo">
                        <svg width="32" height="32" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="6" y="6" width="28" height="28" rx="6" fill="#34A853"/>
                            <rect x="10" y="12" width="20" height="16" rx="2" fill="white"/>
                            <path d="M14 18h12M14 21h8M14 24h6" stroke="#34A853" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span class="logo-text">Invoice-Generator<span class="logo-domain">.com</span></span>
                    </div>
                </div>

                <!-- Login Form -->
                <div id="loginForm" class="auth-form">
                    <h2>Sign In</h2>
                    <p class="welcome-text">Welcome back!</p>
                    
                    <form id="emailLoginForm" onsubmit="handleEmailLogin(event)">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-label-row">
                                <label for="loginPassword">Password</label>
                                <a href="#" class="forgot-link" onclick="showForgotPassword()">Forgot password?</a>
                            </div>
                            <input type="password" id="loginPassword" required>
                        </div>
                        
                        <div class="form-checkbox">
                            <input type="checkbox" id="keepLoggedIn">
                            <label for="keepLoggedIn">Keep me logged in</label>
                        </div>
                        
                        <button type="submit" class="auth-btn primary">Sign In</button>
                    </form>
                    
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <button class="auth-btn google" onclick="handleGoogleSignIn()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19.9895 10.1871C19.9895 9.36767 19.9214 8.76973 19.7742 8.14966H10.1992V11.848H15.8195C15.7062 12.7671 15.0943 14.1512 13.7346 15.0813L13.7155 15.2051L16.7429 17.4969L16.9647 17.5193C18.8789 15.7789 19.9895 13.221 19.9895 10.1871Z" fill="#4285F4"/>
                            <path d="M10.1993 19.9313C12.9527 19.9313 15.2643 19.0454 16.9648 17.5194L13.7347 15.0814C12.8734 15.6682 11.7176 16.0779 10.1993 16.0779C7.50243 16.0779 5.21946 14.3375 4.40014 11.9366L4.2804 11.9465L1.13907 14.3273L1.0957 14.4391C2.78537 17.8059 6.21834 19.9313 10.1993 19.9313Z" fill="#34A853"/>
                            <path d="M4.39899 11.9366C4.1758 11.3166 4.04811 10.6521 4.04811 9.96562C4.04811 9.27905 4.1758 8.61456 4.38773 7.99456L4.38176 7.86257L1.19509 5.44363L1.09445 5.49211C0.397632 6.84305 0.00195312 8.36398 0.00195312 9.96562C0.00195312 11.5672 0.397632 13.0882 1.09445 14.4391L4.39899 11.9366Z" fill="#FBBC05"/>
                            <path d="M10.1993 3.85336C12.1142 3.85336 13.406 4.66168 14.1425 5.33718L17.0207 2.59107C15.253 0.985496 12.9527 0 10.1993 0C6.2183 0 2.78537 2.12535 1.0957 5.49214L4.38789 7.99458C5.21946 5.59367 7.50243 3.85336 10.1993 3.85336Z" fill="#EB4335"/>
                        </svg>
                        Sign in with Google
                    </button>
                    
                    <p class="auth-switch">
                        Don't have an account yet? <a href="#" onclick="showSignUp()">Sign Up</a>
                    </p>
                </div>

                <!-- Signup Form -->
                <div id="signupForm" class="auth-form hidden">
                    <h2>Sign Up</h2>
                    <p class="welcome-text">Create your account</p>
                    
                    <form id="emailSignupForm" onsubmit="handleEmailSignup(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="signupFirstName">First Name</label>
                                <input type="text" id="signupFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="signupLastName">Last Name</label>
                                <input type="text" id="signupLastName" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" id="signupPassword" required minlength="6">
                            <small class="form-hint">Minimum 6 characters</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="signupConfirmPassword">Confirm Password</label>
                            <input type="password" id="signupConfirmPassword" required>
                        </div>
                        
                        <div class="form-checkbox">
                            <input type="checkbox" id="agreeTerms" required>
                            <label for="agreeTerms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                        </div>
                        
                        <button type="submit" class="auth-btn primary">Create Account</button>
                    </form>
                    
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <button class="auth-btn google" onclick="handleGoogleSignIn()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19.9895 10.1871C19.9895 9.36767 19.9214 8.76973 19.7742 8.14966H10.1992V11.848H15.8195C15.7062 12.7671 15.0943 14.1512 13.7346 15.0813L13.7155 15.2051L16.7429 17.4969L16.9647 17.5193C18.8789 15.7789 19.9895 13.221 19.9895 10.1871Z" fill="#4285F4"/>
                            <path d="M10.1993 19.9313C12.9527 19.9313 15.2643 19.0454 16.9648 17.5194L13.7347 15.0814C12.8734 15.6682 11.7176 16.0779 10.1993 16.0779C7.50243 16.0779 5.21946 14.3375 4.40014 11.9366L4.2804 11.9465L1.13907 14.3273L1.0957 14.4391C2.78537 17.8059 6.21834 19.9313 10.1993 19.9313Z" fill="#34A853"/>
                            <path d="M4.39899 11.9366C4.1758 11.3166 4.04811 10.6521 4.04811 9.96562C4.04811 9.27905 4.1758 8.61456 4.38773 7.99456L4.38176 7.86257L1.19509 5.44363L1.09445 5.49211C0.397632 6.84305 0.00195312 8.36398 0.00195312 9.96562C0.00195312 11.5672 0.397632 13.0882 1.09445 14.4391L4.39899 11.9366Z" fill="#FBBC05"/>
                            <path d="M10.1993 3.85336C12.1142 3.85336 13.406 4.66168 14.1425 5.33718L17.0207 2.59107C15.253 0.985496 12.9527 0 10.1993 0C6.2183 0 2.78537 2.12535 1.0957 5.49214L4.38789 7.99458C5.21946 5.59367 7.50243 3.85336 10.1993 3.85336Z" fill="#EB4335"/>
                        </svg>
                        Sign up with Google
                    </button>
                    
                    <p class="auth-switch">
                        Already have an account? <a href="#" onclick="showSignIn()">Sign In</a>
                    </p>
                </div>

                <!-- Demo Mode Section -->
                <div class="demo-section">
                    <div class="divider">
                        <span>For Testing</span>
                    </div>
                    <button onclick="enableDemoMode()" class="auth-btn demo">
                        üîß Try Demo Mode
                    </button>
                    <button onclick="debugGoogleAuth()" class="auth-btn demo" style="background: #6c757d; margin-top: 8px;">
                        üîç Debug Google Auth
                    </button>
                    <button onclick="debugUserEmail()" class="auth-btn demo" style="background: #17a2b8; margin-top: 8px;">
                        üîç Check Email Status
                    </button>
                    <button onclick="debugFirebaseFunctions()" class="auth-btn demo" style="background: #28a745; margin-top: 8px;">
                        üîß Test Firebase Functions
                    </button>
                    <small>Test all features without creating an account</small>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="section hidden">
            <header>
                <h1>Invoice Generator</h1>
                <div class="user-info">
                    <span id="userEmail"></span>
                    <button onclick="loadUserDataFromFirebase()" style="background: #28a745; margin-right: 10px;">Reload Data</button>
                    <button onclick="signOut()">Sign Out</button>
                </div>
            </header>

            <nav class="tabs">
                <button class="tab active" onclick="showTab('create')">Create Invoice</button>
                <button class="tab" onclick="showTab('template')">Edit Template</button>
                <button class="tab" onclick="showTab('history')">History</button>
            </nav>

            <!-- Create Invoice Tab -->
            <div id="createTab" class="tab-content">
                <form id="invoiceForm">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3>Client Information</h3>
                            <input type="text" id="clientCompany" placeholder="Company Name" required>
                            <textarea id="clientAddress" placeholder="Client Address" required></textarea>
                            <input type="text" id="clientVAT" placeholder="VAT Number">
                            <input type="email" id="clientEmail" placeholder="Client Email" required>
                            <input type="tel" id="clientPhone" placeholder="Phone Number">
                        </div>

                        <div class="form-section">
                            <h3>Invoice Details</h3>
                            <input type="text" id="invoiceNumber" placeholder="Invoice Number" required>
                            <input type="date" id="invoiceDate" required>
                            <input type="text" id="yourRef" placeholder="Your Reference">
                            <input type="text" id="cxRef" placeholder="CX Reference">
                            <input type="text" id="customerRef" placeholder="Customer Reference">
                        </div>

                        <div class="form-section">
                            <h3>Delivery Details</h3>
                            <input type="date" id="deliveryDate" placeholder="Delivery Date" required>
                            <select id="vehicleType" required>
                                <option value="">Select Vehicle Type</option>
                                <option value="LWB up to 4m">LWB up to 4m</option>
                                <option value="SWB">SWB</option>
                                <option value="Transit Van">Transit Van</option>
                                <option value="7.5 Tonne">7.5 Tonne</option>
                            </select>
                            <textarea id="pickupAddress" placeholder="Pickup Address" required></textarea>
                            <textarea id="deliveryAddress" placeholder="Delivery Address" required></textarea>
                            <input type="time" id="deliveryTime" placeholder="Delivery Time">
                            <input type="text" id="receivedBy" placeholder="Received By">
                            <input type="text" id="leftAt" placeholder="Left At">
                            <textarea id="deliveryNotes" placeholder="Delivery Notes"></textarea>
                        </div>

                        <div class="form-section">
                            <h3>Pricing</h3>
                            <input type="number" id="unitCost" placeholder="Unit Cost (¬£)" step="0.01" required>
                            <input type="number" id="paymentDays" placeholder="Payment Terms (Days)" value="30">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="previewInvoice()">Preview</button>
                        <button type="button" onclick="generatePDF()">Generate PDF</button>
                        <button type="button" onclick="sendEmail()">Send Email</button>
                        <button type="button" onclick="clearInvoiceForm()" style="background: #6c757d;">Clear Form</button>
                    </div>
                </form>
            </div>

            <!-- Template Tab -->
            <div id="templateTab" class="tab-content hidden">
                <h3>Edit Your Template</h3>
                <form id="templateForm">
                    <div class="form-grid">
                        <div class="form-section">
                            <h4>Your Business Information</h4>
                            <input type="text" id="businessName" placeholder="Business Name">
                            <textarea id="businessAddress" placeholder="Business Address"></textarea>
                            <input type="tel" id="businessPhone" placeholder="Phone">
                            <input type="email" id="businessEmail" placeholder="Email">
                            <input type="text" id="memberID" placeholder="Member ID">
                        </div>

                        <div class="form-section">
                            <h4>Bank Details</h4>
                            <input type="text" id="bankName" placeholder="Bank Name">
                            <input type="text" id="accountHolder" placeholder="Account Holder Name">
                            <input type="text" id="sortCode" placeholder="Sort Code">
                            <input type="text" id="accountNumber" placeholder="Account Number">
                        </div>
                    </div>
                    <button type="button" onclick="saveTemplate()">Save Template</button>
                </form>
            </div>

            <!-- History Tab -->
            <div id="historyTab" class="tab-content hidden">
                <h3>Invoice History</h3>
                <div id="invoiceHistory"></div>
            </div>
        </div>

        <!-- Preview Modal -->
        <div id="previewModal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <div id="invoicePreview"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>